# 微服务

微服务系统架构

一个服务实现一个不同的特性或者功能，每个独立的微服务是一个小型应用。

微服务也有一定的缺陷，比如说每个服务如果都有一个数据库的话，那么如何维持数据库事务。再比如说，服务之间调用可能由于网络的原因变得不可达，那么代码中要额外增加请求失败的代码。

## GGRPC

远程过程调用
高性能，开源和通用的RPC框架，面向移动和HTTP/2设计

在GRPC里客户端应用可以像调用本地对象一样直接调用另一台不同的机器上服务端应用的方法，使得更能容易地创建分布式应用和服务。


## 整体架构的优缺点

- 开发简单直接,集中式管理,基本不会重复开发.没有分布式的管理开销和调用开销
but
- 开发效率低: 所有的开发在一个项目中改代码, 代码冲突多
- 代码维护难：代码功能耦合在一起，新人不知道何从下手
- 部署不灵活：构建时间长，任何小修改必须重新构建整个项目，这个过程往往很长
- 稳定性不高：一个微不足道的小问题，可以导致整个应用挂掉
- 扩展性不够：无法满足高并发情况下的业务需求

## 微服务优缺点

- 每个微服务都很小，这样能聚焦一个指定的业务功能或业务需求。
- 微服务能够被小团队单独开发，这个小团队是2到5人的开发人员组成。
- 微服务是松耦合的，是有功能意义的服务，无论是在开发阶段或部署阶段都是独立的。
- 微服务能使用不同的语言开发。
- 微服务允许容易且灵活的方式集成自动部署，通过持续集成工具，如Jenkins, bamboo 。
- 一个团队的新成员能够更快投入生产。
- 微服务易于被一个开发人员理解，修改和维护，这样小团队能够更关注自己的工作成果。无需通过合作才能体现价值。
- 微服务允许你利用融合最新技术。
- 微服务只是业务逻辑的代码，不会和HTML,CSS 或其他界面组件混合。
- 微服务能够即时被要求扩展。
- 微服务能部署中低端配置的服务器上。
- 易于和第三方集成。
- 每个微服务都有自己的存储能力，可以有自己的数据库。也可以有统一数据库。
- 微服务架构可能带来过多的操作。
- 需要DevOps技巧。
- 可能双倍的努力。
- 分布式系统可能复杂难以管理。
- 因为分布部署跟踪问题难。
- 当服务数量增加，管理复杂性增加。

## 并发

多任务，多进程，多线程

## 多线程的目的是为了最大限度的利用CPU资源

- 多任务、多进程、多线程的前提都是要求操作系统提供多任务、多进程、多线程的支持。
- 操作系统的都进程实现了多任务并发执行，程序的多线程实现了进程的并发执行。

* 分流 分流 分流

* 限流 限流 限流

* 缓存 缓存 缓存  (尽量不要让大量请求穿透到DB层)

* 异步 异步 异步  (异步处理逻辑 如:日志)

* 主备 主备 主备

小规模并发问题 可以通过加锁,进程队列来解决

大规模的并发问题 就需要考虑用分布式集群来应对瞬时高并发

SLB 服务器负载均衡  流量分发  消除单点故障  (nignx)

kafka或redis可以做消息队列

分布式关系型数据库 DRDS

? ? ?
* 如何防止恶意调用接口？
* 消息队列处理完成后，如果异步通知给用户操作成功？
* 如何保障 Redis、Zookeeper 、Kafka 服务的正常运行(高可用)？
* 高并发下的业务如何做到不影响其他业务(隔离性)？
